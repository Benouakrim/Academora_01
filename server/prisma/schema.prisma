generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                      String            @id @default(uuid())
  clerkId                 String            @unique
  email                   String            @unique
  firstName               String?
  lastName                String?
  avatarUrl               String?
  gpa                     Float?
  satScore                Int?
  actScore                Int?
  preferredMajor          String?
  dreamJobTitle           String?
  careerGoals             String[]
  preferredLearningStyle  String?
  personalityType         String?
  hobbies                 String[]
  languagesSpoken         String[]
  role                    UserRole          @default(USER)
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
  referralCode            String?           @unique
  referredBy              String?
  accountType             String?
  focusArea               String?
  onboarded               Boolean           @default(false)
  onboardingAnswers       Json?
  organizationName        String?
  personaRole             String?
  primaryGoal             String?
  onboardingSkipped       Boolean           @default(false)
  profileSettings         Json?
  profileVisibility       ProfileVisibility @default(PRIVATE)
  username                String?           @unique
  academicProfile         AcademicProfile?
  analysisWeights         AnalysisWeights?
  articles                Article[]            @relation("ArticleAuthor")
  reviewedArticles        Article[]            @relation("ArticleReviewer")
  articleLikes            ArticleLike[]
  ClaimMessage            ClaimMessage[]
  comments                Comment[]
  reviewedDocuments       DocumentApproval[]   @relation("DocumentReviewer")
  comparisons             Comparison[]
  financialProfile        FinancialProfile?
  notifications           Notification[]
  referralsReceived       Referral?         @relation("Referred")
  referralsGiven          Referral[]        @relation("Referrer")
  reviews                 Review[]
  savedUniversities       SavedUniversity[]
  claimedUniversities     University[]      @relation("UniversityClaim")
  reviewedClaims          UniversityClaim[] @relation("ClaimReviewer")
  universityClaims        UniversityClaim[]
  claimedUniversityGroups UniversityGroup[] @relation("UniversityGroupClaim")
  referrer                User?             @relation("UserReferrals", fields: [referredBy], references: [id])
  referrals               User[]            @relation("UserReferrals")
  badges                  UserBadge[]

  @@index([clerkId])
  @@index([username])
}

model University {
  id                       String                     @id @default(uuid())
  slug                     String                     @unique
  name                     String
  shortName                String?
  description              String?
  logoUrl                  String?
  heroImageUrl             String?
  websiteUrl               String?
  established              Int?
  address                  String?
  city                     String
  state                    String?
  zipCode                  String?
  country                  String                     @default("USA")
  latitude                 Float?
  longitude                Float?
  climateZone              String?
  nearestAirport           String?
  region                   String?
  type                     InstitutionType?
  classification           String?
  religiousAffiliation     String?
  setting                  CampusSetting?
  campusSizeAcres          Int?
  acceptanceRate           Float?
  applicationFee           Int?
  commonAppAccepted        Boolean                    @default(false)
  applicationDeadline      DateTime?
  earlyDecisionDeadline    DateTime?
  testPolicy               TestPolicy?
  minGpa                   Float?
  avgGpa                   Float?
  satMath25                Int?
  satMath75                Int?
  satVerbal25              Int?
  satVerbal75              Int?
  actComposite25           Int?
  actComposite75           Int?
  avgSatScore              Int?
  avgActScore              Int?
  internationalEngReqs     Json?
  tuitionInState           Int?
  tuitionOutState          Int?
  tuitionInternational     Int?
  roomAndBoard             Int?
  booksAndSupplies         Int?
  costOfLiving             Int?
  percentReceivingAid      Float?
  averageGrantAid          Int?
  averageNetPrice          Int?
  scholarshipsIntl         Boolean                    @default(false)
  needBlindAdmission       Boolean                    @default(false)
  studentPopulation        Int?
  undergraduatePopulation  Int?
  graduatePopulation       Int?
  studentFacultyRatio      Float?
  percentMale              Float?
  percentFemale            Float?
  percentInternational     Float?
  diversityScore           Float?
  graduationRate           Float?
  retentionRate            Float?
  employmentRate           Float?
  averageStartingSalary    Int?
  internshipSupport        Int?
  alumniNetwork            Int?
  visaDurationMonths       Int?
  academicCalendar         AcademicCalendar?
  sportsDivision           String?
  hasHousing               Boolean                    @default(true)
  studentLifeScore         Float?
  safetyRating             Float?
  partySceneRating         Float?
  popularMajors            String[]
  degreeLevels             String[]
  languages                String[]
  studentLifeTags          String[]
  rankings                 Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @updatedAt
  claimedAt                DateTime?
  claimedById              String?
  ROIPercentage            Float?
  alumniEarnings10Years    Int?
  alumniEarnings5Years     Int?
  averageSalaryByMajor     Json?
  citationIndex            Int?
  fundedResearch           Int?
  geographicDiversityScore Float?
  industryPartnerships     String[]
  internshipPlacementRate  Float?
  partnerCompaniesCount    Int?
  researchOutputScore      Float?
  studentSatisfactionScore Float?
  timeToEmploymentMonths   Int?
  riskAssessments          ComparisonRiskAssessment[]
  microContent             MicroContent[]
  reviews                  Review[]
  savedBy                  SavedUniversity[]
  claimedBy                User?                      @relation("UniversityClaim", fields: [claimedById], references: [id])
  claims                   UniversityClaim[]
  metricHistory            UniversityMetricHistory[]
  groups                   UniversityGroup[]          @relation("GroupMembership")

  @@index([slug])
  @@index([country])
  @@index([name])
  @@index([tuitionOutState])
  @@index([avgSatScore])
}

model SavedUniversity {
  id           String            @id @default(uuid())
  userId       String
  universityId String
  status       ApplicationStatus @default(PLANNED)
  notes        String?
  createdAt    DateTime          @default(now())
  university   University        @relation(fields: [universityId], references: [id], onDelete: Cascade)
  user         User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, universityId])
}

model UniversityClaim {
  id                    String           @id @default(uuid())
  userId                String
  universityId          String?
  status                ClaimStatus      @default(PENDING)
  claimType             ClaimType        @default(ACADEMIC_STAFF)
  institutionalEmail    String
  verificationDocuments String[]
  position              String?
  department            String?
  comments              String?
  createdAt             DateTime         @default(now())
  updatedAt             DateTime         @updatedAt
  adminNotes            String?
  expiresAt             DateTime?
  requesterEmail        String           @default("")
  requesterName         String           @default("")
  reviewedAt            DateTime?
  reviewedById          String?
  universityGroupId     String?
  viewedAt              DateTime?
  auditLog              Json?               @default("[]")
  ClaimMessage          ClaimMessage[]
  documentApprovals     DocumentApproval[]
  reviewedBy            User?               @relation("ClaimReviewer", fields: [reviewedById], references: [id])
  universityGroup       UniversityGroup?    @relation(fields: [universityGroupId], references: [id], onDelete: Cascade)
  university            University?         @relation(fields: [universityId], references: [id], onDelete: Cascade)
  user                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([universityId])
  @@index([universityGroupId])
  @@index([status])
}

model DocumentApproval {
  id               String              @id @default(uuid())
  claimId          String
  documentUrl      String
  documentType     String              // "image" or "pdf"
  documentName     String
  status           DocumentStatus      @default(PENDING)
  adminNotes       String?
  reviewedAt       DateTime?
  reviewedById     String?
  canResubmit      Boolean             @default(true)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  claim            UniversityClaim     @relation(fields: [claimId], references: [id], onDelete: Cascade)
  reviewedBy       User?               @relation("DocumentReviewer", fields: [reviewedById], references: [id])

  @@index([claimId])
  @@index([status])
}

model FinancialProfile {
  id                         String   @id @default(uuid())
  userId                     String   @unique
  maxBudget                  Int?
  householdIncome            Int?
  familySize                 Int?
  savings                    Int?
  investments                Int?
  expectedFamilyContribution Int?
  eligibleForPellGrant       Boolean  @default(false)
  eligibleForStateAid        Boolean  @default(false)
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt
  needsFinancialAid          Boolean  @default(false)
  user                       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model AcademicProfile {
  id               String   @id @default(uuid())
  userId           String   @unique
  gpa              Float?
  gpaScale         Int?
  testScores       Json?
  highSchoolName   String?
  gradYear         Int?
  primaryMajor     String?
  secondaryMajor   String?
  extracurriculars String[]
  academicHonors   Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([gradYear])
  @@index([gpa])
  @@index([primaryMajor])
}

model Comparison {
  id              String                     @id @default(uuid())
  name            String
  userId          String
  universityIds   String[]
  createdAt       DateTime                   @default(now())
  description     String?
  user            User                       @relation(fields: [userId], references: [id], onDelete: Cascade)
  insights        ComparisonInsight[]
  riskAssessments ComparisonRiskAssessment[]
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
}

model Referral {
  id             String         @id @default(uuid())
  referrerId     String
  referredUserId String         @unique
  status         ReferralStatus @default(PENDING)
  rewardClaimed  Boolean        @default(false)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  rewardAmount   Int            @default(0)
  referredUser   User           @relation("Referred", fields: [referredUserId], references: [id], onDelete: Cascade)
  referrer       User           @relation("Referrer", fields: [referrerId], references: [id], onDelete: Cascade)

  @@index([referrerId])
  @@index([status])
}

model Category {
  id          String    @id @default(uuid())
  name        String
  slug        String    @unique
  description String?
  createdAt   DateTime  @default(now())
  articles    Article[]
}

model Tag {
  id        String    @id @default(uuid())
  name      String    @unique
  slug      String    @unique
  createdAt DateTime  @default(now())
  articles  Article[] @relation("ArticleToTag")
}

model Article {
  id              String              @id @default(uuid())
  slug            String              @unique
  title           String
  excerpt         String?
  content         String
  featuredImage   String?
  status          ArticleStatus       @default(DRAFT)
  publishedAt     DateTime?
  metaTitle       String?
  metaDescription String?
  authorId        String
  categoryId      String?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  viewCount       Int                 @default(0)
  canonicalUrl    String?
  focusKeyword    String?
  likeCount       Int                 @default(0)
  ogImage         String?
  rejectionReason String?
  reviewedAt      DateTime?
  reviewedById    String?
  shareCount      Int                 @default(0)
  author          User                @relation("ArticleAuthor", fields: [authorId], references: [id])
  category        Category?           @relation(fields: [categoryId], references: [id])
  reviewedBy      User?               @relation("ArticleReviewer", fields: [reviewedById], references: [id])
  analytics       ArticleAnalytics[]
  likes           ArticleLike[]
  predictions     ArticlePrediction[]
  comments        Comment[]
  tags            Tag[]               @relation("ArticleToTag")

  @@index([slug])
  @@index([status])
  @@index([authorId])
}

model ArticleLike {
  id        String   @id @default(uuid())
  articleId String
  userId    String
  createdAt DateTime @default(now())
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([articleId, userId])
  @@index([articleId])
  @@index([userId])
}

model ArticleAnalytics {
  id        String   @id @default(uuid())
  articleId String
  date      DateTime @default(now())
  views     Int      @default(0)
  likes     Int      @default(0)
  comments  Int      @default(0)
  shares    Int      @default(0)
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, date])
  @@index([articleId])
  @@index([date])
}

model Comment {
  id        String    @id @default(uuid())
  content   String
  articleId String
  userId    String
  parentId  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  downvotes Int       @default(0)
  upvotes   Int       @default(0)
  article   Article   @relation(fields: [articleId], references: [id], onDelete: Cascade)
  parent    Comment?  @relation("CommentThread", fields: [parentId], references: [id])
  replies   Comment[] @relation("CommentThread")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Review {
  id             String       @id @default(uuid())
  rating         Float
  academicRating Float?
  campusRating   Float?
  socialRating   Float?
  careerRating   Float?
  title          String?
  content        String
  status         ReviewStatus @default(PENDING)
  universityId   String
  userId         String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  anonymous      Boolean      @default(false)
  helpfulCount   Int          @default(0)
  verified       Boolean      @default(false)
  university     University   @relation(fields: [universityId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, universityId])
  @@index([universityId])
  @@index([status])
}

model UniversityGroup {
  id           String            @id @default(uuid())
  name         String
  slug         String            @unique
  description  String?
  logoUrl      String?
  website      String?
  memberCount  Int               @default(0)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  claimedAt    DateTime?
  claimedById  String?
  claims       UniversityClaim[]
  claimedBy    User?             @relation("UniversityGroupClaim", fields: [claimedById], references: [id])
  universities University[]      @relation("GroupMembership")
}

model MicroContent {
  id           String     @id @default(uuid())
  universityId String
  category     String
  title        String
  content      String
  priority     Int        @default(0)
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  university   University @relation(fields: [universityId], references: [id])

  @@index([universityId])
}

model StaticPage {
  id              String   @id @default(uuid())
  slug            String   @unique
  title           String
  content         String
  metaTitle       String?
  metaDescription String?
  published       Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model Badge {
  id          String      @id @default(uuid())
  slug        String      @unique
  name        String
  description String?
  iconUrl     String?
  category    String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  userBadges  UserBadge[]

  @@index([slug])
  @@index([category])
}

model UserBadge {
  id        String   @id @default(uuid())
  userId    String
  badgeId   String
  awardedAt DateTime @default(now())
  badge     Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
}

model UniversityMetricHistory {
  id             String     @id @default(uuid())
  universityId   String
  year           Int
  ranking        Int?
  acceptanceRate Float?
  tuitionCost    Int?
  employmentRate Float?
  averageSalary  Int?
  studentCount   Int?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  university     University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@unique([universityId, year])
  @@index([universityId])
  @@index([year])
}

model AnalysisWeights {
  id                  String   @id @default(uuid())
  userId              String   @unique
  ranking             Float    @default(0.25)
  cost                Float    @default(0.25)
  acceptance          Float    @default(0.15)
  employmentRate      Float    @default(0.15)
  studentSatisfaction Float    @default(0.10)
  research            Float    @default(0.10)
  targetSalary        Int?
  careerFocus         String?
  preferredLocation   String?
  internshipImportant Boolean  @default(false)
  researchImportant   Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model ComparisonRiskAssessment {
  id               String     @id @default(uuid())
  comparisonId     String
  universityId     String
  riskFactors      Json
  overallRiskScore Float
  recommendations  String[]
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  comparison       Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)
  university       University @relation(fields: [universityId], references: [id], onDelete: Cascade)

  @@unique([comparisonId, universityId])
  @@index([comparisonId])
  @@index([universityId])
}

model ComparisonInsight {
  id           String     @id @default(uuid())
  comparisonId String
  insight      String
  insightType  String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  comparison   Comparison @relation(fields: [comparisonId], references: [id], onDelete: Cascade)

  @@index([comparisonId])
  @@index([insightType])
}

model ArticlePrediction {
  id        String   @id @default(uuid())
  articleId String
  inputHash String   @unique
  features  Json
  result    Json
  version   Int      @default(1)
  createdAt DateTime @default(now())
  article   Article  @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId])
  @@index([inputHash])
  @@index([createdAt])
}

model SystemBenchmark {
  id                 String   @id @default(uuid())
  category           String   @unique
  rpm                Float
  avgSearchVolume    Int
  avgCTR             Float
  seasonalMultiplier Float    @default(1.0)
  competitionLevel   Int      @default(5)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([category])
}

model Video {
  id           String   @id @default(uuid())
  title        String
  description  String?
  url          String
  publicId     String?
  type         String
  thumbnailUrl String?
  position     Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([isActive, position])
  @@index([createdAt])
}

model ClaimMessage {
  id                 String            @id
  claimId            String
  senderId           String
  senderRole         String
  content            String
  type               CommunicationType @default(CHAT)
  requestedDocuments String[]
  attachments        String[]
  dataRequestSchema  Json?
  submittedData      Json?
  read               Boolean           @default(false)
  createdAt          DateTime          @default(now())
  UniversityClaim    UniversityClaim   @relation(fields: [claimId], references: [id], onDelete: Cascade)
  User               User              @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([claimId])
  @@index([senderId])
}

enum UserRole {
  USER
  ADMIN
  PREMIUM
}

enum ApplicationStatus {
  PLANNED
  APPLIED
  ACCEPTED
  REJECTED
  WAITLISTED
}

enum ArticleStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
  PENDING
  REJECTED
}

enum ReviewStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InstitutionType {
  PUBLIC
  PRIVATE_NON_PROFIT
  PRIVATE_FOR_PROFIT
}

enum CampusSetting {
  URBAN
  SUBURBAN
  RURAL
}

enum AcademicCalendar {
  SEMESTER
  QUARTER
  TRIMESTER
}

enum TestPolicy {
  REQUIRED
  OPTIONAL
  BLIND
}

enum ClaimStatus {
  PENDING
  APPROVED
  REJECTED
  VERIFIED
  UNDER_REVIEW
  ACTION_REQUIRED
  PENDING_DOCUMENTS
  ARCHIVED
}

enum ClaimType {
  ACADEMIC_STAFF
  ALUMNI
  STUDENT
  ADMINISTRATIVE_STAFF
}

enum DocumentStatus {
  PENDING
  APPROVED
  REJECTED
  REPLACED
}

enum CommunicationType {
  CHAT
  DOCUMENT_REQUEST
  INTERNAL_NOTE
}

enum ReferralStatus {
  PENDING
  COMPLETED
}

enum ProfileVisibility {
  PUBLIC
  PRIVATE
  FOLLOWERS_ONLY
}
